{
    "$id": "http://bsgip.com/e-json",
    "type": "object",
    "properties": {
        "ejson_version": {
            "type": "string",
            "pattern": "[0-9]+.[0-9]+.[0.9]+",
            "description": "Version number in the form <a>.<b>.<c>. Versions start at 1.0; a increments at major breaking changes, b increments at minor breaking changes, and c increments for non-breaking changes",
            "examples": ["1.0.0"]
        },
        "voltage_type": {
            "type": "string",
            "description": "Voltage type, ll (line to line) or lg (line to ground)",
            "examples": ["ll", "lg"]
        },
        "id": {
            "type": "string",
            "description": "optional network ID"
        },
        "user_data": {
            "type": "object",
            "description": "Non-e-json annotations",
            "examples": [{"network_version": 7}]
        },
        "components": {
            "type": "array",
            "description": "List of all network components (nodes and elements)",
            "items": {
                "$ref": "#/definitions/component"
            }
        }
    },
    "required": ["components"],
    "additionalProperties": false,
    "definitions": {
        "complexNumber": {
            "@ref": "#/definitions/twoNumberArray",
            "description": "Complex number, stored as [<real>, <imag>]",
            "examples": [[4, 7]]
        },
        "positiveNumber": {
            "type": "number",
            "minimum": 0
        },
        "twoNumberArray": {
            "type": "array",
            "items": {
                "type": "number"
            },
            "minItems": 2,
            "maxItems": 2
        },
        "twoPositiveNumberArray": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/positiveNumber"
            },
            "minItems": 2,
            "maxItems": 2
        },
        "twoComplexNumberArray": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/complexNumber"
            },
            "minItems": 2,
            "maxItems": 2
        },
        "complexArray": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/complexNumber"
            }
        },
        "complexMatrix": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/complexArray"
            },
            "description": "Row major complex matrix",
            "examples": [
                [
                    [[1, 0], [1, 1]],
                    [[0, 1], [1, 1]]
                ]
            ]
        },
        "phs": {
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "string"
            },
            "description": "List of phases",
            "examples": [["A", "B", "C"]]
        },
        "connection": {
            "type": "object",
            "properties": {
                "node": {
                    "type": "string"
                },
                "phs": {
                    "$ref": "#/definitions/phs"
                }
            },
            "required": ["node", "phs"],
            "description": "List of connections from element terminals. Each connection gives the node ID and phases to which the element is connected",
            "examples": [[{"node": "node_1", "phs": ["A", "C"]}, {"node": "node_2", "phs": ["A", "C"]}]]
        },
        "oneConnection": {
            "type": "array",
            "minItems": 1,
            "maxItems": 1,
            "items": {
                "$ref": "#/definitions/connection"
            }
        },
        "twoConnections": {
            "type": "array",
            "minItems": 2,
            "maxItems": 2,
            "items": {
                "$ref": "#/definitions/connection"
            }
        },
        "twoOrMoreConnections": {
            "type": "array",
            "minItems": 2,
            "items": {
                "$ref": "#/definitions/connection"
            }
        },
        "elementWiring": {
            "description": "delta (LL) or wye (LG).",
            "type": "string",
            "enum": ["delta", "wye"]
        },
        "inService": {
            "description": "If false, the component is out of service.",
            "default": true,
            "type": "boolean"
        },
        "component": {
            "oneOf": [
                {
                    "$ref": "#/definitions/nodeComponent"
                },
                {
                    "$ref": "#/definitions/infeederComponent"
                },
                {
                    "$ref": "#/definitions/genComponent"
                },
                {
                    "$ref": "#/definitions/loadComponent"
                },
                {
                    "$ref": "#/definitions/lineComponent"
                },
                {
                    "$ref": "#/definitions/connectorComponent"
                },
                {
                    "$ref": "#/definitions/transformerComponent"
                }
            ]
        },
        "nodeComponent": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "const": "Node"
                },
                "phs": {
                    "$ref": "#/definitions/phs"
                },
                "user_data": {
                    "type": "object"
                },
                "v": {
                    "$ref": "#/definitions/complexArray"
                },
                "v_base": {
                    "$ref": "#/definitions/positiveNumber"
                },
                "lat_long": {
                    "ref": "#/definitions/twoNumberArray"
                },
                "xy": {
                    "ref": "#/definitions/twoNumberArray"
                }
            },
            "required": ["id", "type", "phs", "v_base"],
            "additionalProperties": false,
            "description": "Network node"
        },
        "infeederComponent": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "const": "Infeeder"
                },
                "cons": {
                    "$ref": "#/definitions/oneConnection"
                },
                "user_data": {
                    "type": "object"
                },
                "in_service": {"$ref": "#/definitions/inService"},
                "v_setpoint": {
                    "$ref": "#/definitions/positiveNumber",
                    "description": "Line to ground voltage magnitude setpoint"
                },
                "i_max": {
                    "type": ["number", "null"]
                }
            },
            "required": ["id", "type", "cons", "v_setpoint"],
            "additionalProperties": false,
            "description": "Network infeeder with constant voltage"
        },
        "genComponent": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "const": "Generator"
                },
                "cons": {
                    "$ref": "#/definitions/oneConnection"
                },
                "user_data": {
                    "type": "object"
                },
                "in_service": {"$ref": "#/definitions/inService"},
                "wiring": {
                    "$ref": "#/definitions/elementWiring"
                },
                "p_min": {
                    "description": "Minimum power injection (generation convention). ",
                    "type": "number"
                },
                "p_max": {
                    "description": "Maximum power injection (generation convention).",
                    "default": 0,
                    "type": "number"
                },
                "q_min": {
                    "description": "Minimum reactive power injection (generation convention). ",
                    "type": "number"
                },
                "q_max": {
                    "description": "Maximum reactive power injection (generation convention).",
                    "default": 0,
                    "type": "number"
                },
                "cost": {
                    "description": "Cost, in (cost unit) per (energy unit), e.g. $/kWh",
                    "default": 0,
                    "type": "number"
                },
                "fixed_voltage": {
                    "description": "If true, the voltage magnitude is maintained at the setpoint.",
                    "default": false,
                    "type": "boolean"
                },
                "v_setpoint": {
                    "description": "Voltage magnitude setpoint",
                    "type": "number"
                },
                "is_reference": {
                    "description": "If true, the voltage angle is referenced to zero.",
                    "default": false,
                    "type": "boolean"
                },
                "description": "Generator with possibility of voltage control"
            },
            "required": ["id", "type", "cons", "wiring"]
        },
        "loadComponent": {
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "const": "Load"
                },
                "cons": {
                    "$ref": "#/definitions/oneConnection"
                },
                "user_data": {
                    "type": "object"
                },
                "wiring": {
                    "$ref": "#/definitions/elementWiring"
                },
                "s": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/complexNumber"
                    },
                    "minItems": 1
                }
            },
            "required": ["id", "type", "cons"]
        },
        "lineImpedanceZZ0": {
            "type": "object",
            "properties": {
                "z": {
                    "$ref": "#/definitions/complexNumber"
                },
                "z0": {
                    "$ref": "#/definitions/complexNumber"
                },
                "b_chg": {
                    "type": "number"
                }
            },
            "required": ["z", "z0"]
        },
        "lineImpedanceYBus": {
            "properties": {
                "y_bus": {
                    "$ref": "#/definitions/complexMatrix"
                }
            },
            "required": ["y_bus"]
        },
        "lineComponent": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "const": "Line"
                },
                "cons": {
                    "$ref": "#/definitions/twoConnections"
                },
                "user_data": {
                    "type": "object"
                },
                "in_service": {"$ref": "#/definitions/inService"},
                "i_max": {
                    "type": ["number", "null"]
                },
                "length": {
                    "type": "number"
                }
            },
            "required": ["id", "type", "cons", "length"],
            "oneOf": [
                {
                    "$ref": "#/definitions/lineImpedanceZZ0"
                },
                {
                    "$ref": "#/definitions/lineImpedanceYBus"
                }
            ]
        },
        "connectorComponent": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "const": "Connector"
                },
                "cons": {
                    "$ref": "#/definitions/twoOrMoreConnections"
                },
                "user_data": {
                    "type": "object"
                },
                "in_service": {"$ref": "#/definitions/inService"},
                "i_max": {
                    "type": ["number", "null"]
                },
                "switch_state": {
                    "enum": ["closed", "open", "no_switch"]
                }
            },
            "required": ["id", "type", "cons"]
        },
        "transformerTapChanger": {
            "description": "Tap changer for a Transformer",
            "type": "object",
            "properties": {
				"voltage_range": {
                    "type": "array",
                    "items": {
						"$ref": "#/definitions/positiveNumber"
					}
				},
                "indep_taps": {
                    "type": "boolean",
					"default": false
                },
                "winding_side": {
                    "type": "string",
                    "enum": ["primary", "secondary"]
                },
                "winding_idx": {
                    "anyOf": [{
                        "type": "integer",
                        "minimum": 0
                    }, {
                        "type": "string",
                        "const": "avg"
                    }]
                },
                "ctrl": {
                    "type": "string",
                    "enum": ["auto", "manual"],
					"default": "auto"
                },
                "ldc_impedance": {
                    "$ref": "#/definitions/complexNumber"
                },
                "delay_seconds": {
                    "type": "number"
                }
            },
            "required": ["voltage_range", "winding_side", "winding_idx"]
        },
        "transformerComponent": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "const": "Transformer"
                },
                "cons": {
                    "$ref": "#/definitions/twoConnections"
                },
                "user_data": {
                    "type": "object"
                },
                "in_service": {"$ref": "#/definitions/inService"},
                "vector_group": {
                    "type": "string"
                },
                "n_winding_pairs": {
                    "$ref": "#/definitions/positiveNumber"
                },
                "is_grounded_p": {
                    "type": "boolean"
                },
                "is_grounded_s": {
                    "type": "boolean"
                },
                "nom_turns_ratio": {
                    "$ref": "#/definitions/complexNumber"
                },
                "v_winding_base": {
                    "$ref": "#/definitions/twoPositiveNumberArray"
                },
                "z_p": {
                    "$ref": "#/definitions/complexNumber"
                },
                "z_s": {
                    "$ref": "#/definitions/complexNumber"
                },
                "z0_p": {
                    "$ref": "#/definitions/complexNumber"
                },
                "z0_s": {
                    "$ref": "#/definitions/complexNumber"
                },
                "s_max": {
                    "type": "number"
                },
                "tap_range": {
                    "$ref": "#/definitions/twoNumberArray"
                },
                "tap_factor": {
                    "type": "number"
                },
                "tap_side": {
                    "enum": ["primary", "secondary"]
                },
                "tap_changer": {
                    "$ref": "#/definitions/transformerTapChanger"
                },
                "taps": {
                    "type": "array",
                    "items": {
                        "type": "number"
                    }
                }
            },
            "allOf": [
                {
                    "required": ["id", "type", "cons", "vector_group", "nom_turns_ratio", "v_winding_base"]
                },
                {
                    "anyOf": [
                        {
                            "required": ["z_p"]
                        },
                        {
                            "required": ["z_s"]
                        }
                    ]
                }
            ]
        }
    }
}
